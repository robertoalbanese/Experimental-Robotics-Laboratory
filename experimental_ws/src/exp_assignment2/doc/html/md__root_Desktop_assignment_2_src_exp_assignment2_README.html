<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>Exp_Rob Assignment 2: Robot dog Architecture - Assignment 2</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Exp_Rob Assignment 2
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('md__root_Desktop_assignment_2_src_exp_assignment2_README.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Robot dog Architecture - Assignment 2 </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><ul>
<li><b>Author:</b> Roberto Albanese</li>
<li><b>Version:</b> 1.0</li>
<li><b>Date:</b> 12-10-2020</li>
</ul>
<h2>Introduction</h2>
<p>This is the second assignment of the course <em>Experimental Robotics</em>. I am asked to build a ROS architecture to implement a dog alike robotâ€™s behavior. In this project folder the reader will encounter the following folders:</p><ul>
<li><a href="https://github.com/robertoalbanese/Experimental-Robotics-Laboratory/tree/master/experimental_ws/src/exp_assignment2/action">action</a> Action server message;</li>
<li><a href="https://github.com/robertoalbanese/Experimental-Robotics-Laboratory/tree/master/experimental_ws/src/exp_assignment2/config">config</a> Configuration file for head transmission;</li>
<li><a href="https://github.com/robertoalbanese/Experimental-Robotics-Laboratory/tree/master/experimental_ws/src/exp_assignment2/doc/html">doc</a> Doxygen documentation;</li>
<li><a href="https://github.com/robertoalbanese/Experimental-Robotics-Laboratory/tree/master/experimental_ws/src/exp_assignment2/launch">launch</a> Launch files;</li>
<li><a href="https://github.com/robertoalbanese/Experimental-Robotics-Laboratory/tree/master/experimental_ws/src/exp_assignment2/msg">msg</a> Message filse</li>
<li><a href="https://github.com/robertoalbanese/Experimental-Robotics-Laboratory/tree/master/experimental_ws/src/exp_assignment2/scripts">scripts</a> Source files;</li>
<li><a href="https://github.com/robertoalbanese/Experimental-Robotics-Laboratory/tree/master/experimental_ws/src/exp_assignment2/urdf">urdf</a> Urdf models;</li>
<li><a href="https://github.com/robertoalbanese/Experimental-Robotics-Laboratory/tree/master/experimental_ws/src/exp_assignment2/world">world</a> World model.</li>
</ul>
<h2>Software Architecture and System's Features</h2>
<p>The scenario is represented by a robot, simulating a pet, that interacts with a human and moves in a discrete 2D environment. <br />
 The robot has three possible behaviors: it can Sleep, Play or stay in a Normal state.<br />
<br />
 </p>
<div class="image">
<img src="https://github.com/robertoalbanese/Experimental-Robotics-Laboratory/blob/master/experimental_ws/src/exp_assignment2/FSM.png" />
</div>
 <p>In the Normal state the robot has to move randomly.<br />
<br />
 In the Sleep state the robot goes back to the human and sleeps there for a random amount of time. Then it goes back in the Normal state. The robot can pass to the Spleep state only from the Normal state in a random time instant.<br />
<br />
 In the Play state the robot follows the green ball. If the robot reaches the ball and the ball stops, the robot has to look around with his head and then continue following the ball, if possible. The robot can reach the Play state whenever it sees the ball. The robot remains in the Play state untill it cannot see the ball for a certain amount of time (3s).<br />
<br />
 The software architecture is composed by five elements: </p>
<div class="image">
<img src="https://github.com/robertoalbanese/Experimental-Robotics-Laboratory/blob/master/experimental_ws/src/exp_assignment2/Architecture.png" />
</div>
 <ul>
<li><b>User Command</b>: it represents the human command to move the ball;</li>
<li><b>Command Manager</b>: it is the main part of the architecture in which the <b>FSM</b> is;</li>
<li><b>Robot Navigation</b>: it manages the motion of the robot and brings it to the new position goal;</li>
<li><b>Ball Navigation</b>: it manages the motion of the robot and brings it to the new position goal;</li>
<li><b>Perception</b>: Detects the presence of the green ball.</li>
</ul>
<p>Robot Navigation and Ball Navigazion are action servers because they need to execute only when a request is send and they need to be able to stop in any time. Feedback messages are also useful to track the execution of the servers. User Command is meant to be an action server because it has to send requests to Ball Navigation. Perception is a node because it has to live in background and always execute. Command Manager, as well, needs to execute asyncronously ant it is intended to be a node. </p><h3>File list</h3>
<p>In the <a href="https://github.com/robertoalbanese/Experimental-Robotics-Laboratory/tree/master/experimental_ws/src/exp_assignment2/scripts">source folder</a> it is possible to find five files which compose the whole architecture:</p>
<ul>
<li><b><a class="el" href="usr__cmd__client_8py.html" title="Action client to move the ball. ">usr_cmd_client.py</a></b>: in here I have defined an action client which randomly sends reuests to the action server '*/ball/reaching_goal*';</li>
<li><b><a class="el" href="navigation_8py.html" title="Navigation action server. ">navigation.py</a></b>: it waits for a request message of the type <em>Planning.action</em> in which it is present the new position where the robot needs to go, then brings the robot to the goal position by publishing velocities in the topic '*/robot/cmd_vel*';</li>
<li><b><a class="el" href="go__to__point__ball_8py.html" title="Ball navigation action server. ">go_to_point_ball.py</a></b>: same exact behavior of <em><a class="el" href="navigation_8py.html" title="Navigation action server. ">navigation.py</a></em>. The only difference is that the nodes controls the motion of the ball by publishing velocities in the topic '*/ball/cmd_vel*';</li>
<li><b><a class="el" href="state__machine_8py.html" title="FSM of the architecture. ">state_machine.py</a></b> is the core node that manages information from <em>Perception</em> and <em>Robot navigation</em>. It initializes and executes a state machine, using the library <em>smach_ros</em>, in which all the three states and their behaviours are defined.<br />
</li>
</ul>
<p>In the <a href="https://github.com/robertoalbanese/Experimental-Robotics-Laboratory/tree/master/experimental_ws/src/exp_assignment2/action">action folder</a> is it possible to find the file used by the action servers <em>Robot navigation</em> and **Ball Navigation:</p><ul>
<li><b>Planning.action</b>: the goal <em>target_pose</em> represents the position we want to reach. Result in empty. In the feedback are stored the state of the action server and the current position of the object. <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;geometry_msgs/PoseStamped target_pose</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;---</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;---</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;string stat</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;geometry_msgs/Pose position</div></div><!-- fragment --></li>
</ul>
<p>In the <a href="https://github.com/robertoalbanese/Experimental-Robotics-Laboratory/tree/master/experimental_ws/src/exp_assignment2/msg">message folder</a> is it possible to find the file used by the node <em>Perception</em>:</p><ul>
<li><b>BallState.msg</b>: it represents the state of the ball w.r.t. the robot. Here we can find some informations, as the position of the center of the ball w.r.t. the image and its radius. <em>state</em> and <em>ball_reached</em> are used as flags. <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;bool state</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;bool ball_reached</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;int32[2] center</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;float64 radius</div></div><!-- fragment --></li>
</ul>
<p>In the <a href="https://github.com/robertoalbanese/Experimental-Robotics-Laboratory/tree/master/experimental_ws/src/exp_assignment2/launch">launch folder</a> it is possible to find the launch file used to execute all the nodes.</p>
<h2>Installation</h2>
<p>All the following installation are needed by using the docker image given in the beginning of the course. It is possible to install it by following the instraction in: <a href="https://hub.docker.com/r/carms84/rpr">https://hub.docker.com/r/carms84/rpr</a> .<br />
 There are few steps to follow before to being able to execute the code. Firs of all we need to intall the <em>smach</em> library to let ROS to work with finite state machines: </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;$ sudo apt-get install ros-kinetic-smach-viewer</div></div><!-- fragment --><p> Then it is also necessary to install the package imutils (install pip: <a href="https://pip.pypa.io/en/stable/installing/">https://pip.pypa.io/en/stable/installing/</a>):</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;$ pip install imutils</div></div><!-- fragment --><p> Then is it necessary to give running permission to the python source files:</p><ul>
<li>Open the terminal</li>
<li>Move into the folder /../experimental_ws/src/exp_assignment2/scripts</li>
<li>Launch the command: <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;$ chmod +x name_of_the_file.py</div></div><!-- fragment --></li>
</ul>
<p>It's also required to make a <em>catkin_make</em> in your <em>ROS</em> workspace. Check <a href="http://wiki.ros.org/catkin/Tutorials">ROS tutorials</a> to see how to do it.</p>
<h2>Usage</h2>
<p>First of all it is required to source your workspace setup.bash file. To do it open a terminal, move into the workspace directory and the launch the command: </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;source devel/setup.bash</div></div><!-- fragment --><p>If wou want run the whole project just type: </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;$ roslaunch exp_assignment2 gazebo_world.launch </div></div><!-- fragment --><p> The launch file is done in a way that it makes possible to see the state of the <b>FSM</b> in the <em>smach_viewer</em> node automatically.<br />
 A window will pop up showing the image taken from the camera. In the terminal in which the roslaunch command is executed it is possible to see the current positions of the robot.<br />
<br />
 In order to manually execute the nodes/services to see in each terminal the data generated from each node/service, it is required to <em>rosrun</em> each node/service listed in <em>exp_assignment2.launch</em> in the exact same order they are listed in. </p><h2>Software Limitation and Possible technical Improvements</h2>
<h3>Limitations</h3>
<ul>
<li>The routine used to block the robot when the ball stops is not optimal; sometimes the robot think that the ball stopped becuase of the <em>if</em> condition too simplified (the FSM uses the velocity of the robot and the radius of the ball to understand if it has stopped: when the robot is going slow and the ball passes in front of it, the condition is verified (false positive)).</li>
<li>The robot is not able to avoid obstacles. <h3>Possible Improvements</h3>
</li>
</ul>
<ul>
<li>Improvement of the condition to recognise the stopping ball</li>
<li>Obstacle avoidance routine (SLAM and trajectory planning) <h2>Contacts</h2>
</li>
</ul>
<p>Roberto Albanese <a href="#" onclick="location.href='mai'+'lto:'+'ral'+'ba'+'nes'+'e1'+'8@g'+'ma'+'il.'+'co'+'m'; return false;">ralba<span style="display: none;">.nosp@m.</span>nese<span style="display: none;">.nosp@m.</span>18@gm<span style="display: none;">.nosp@m.</span>ail.<span style="display: none;">.nosp@m.</span>com</a> <br />
 <br />
 <br />
</p>
<p><b>Robotics Engineering Master - 2nd year</b> <br />
 <b>University of Genoa</b> </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.11 </li>
  </ul>
</div>
</body>
</html>
