# Assignment 1 of Experimental Robotics Laboratory
## Indrodution

- __PLAY__  
- __NORMAL__ 
- __SLEEP__ 
## Software Architecture and System's Features

* __usr_cmd__ 
* __rand_position__ 
   1. 
   2. 
* __navigation__ 
   
* __state_machine__ is the core node , that manages information from the two previous publishers and implements a _Finite State Machine_ which alternates the three possible states (__PLAY__,__NORMAL__ and __SLEEP__). Finally in according to them it makes some requests to the _Navigation_ service in order to move the robot. 
It should be noted that this node continuously receives positions from the _getPosition_ node but simply ignores such information when it is in a finite state where those data is not needed.

## Finite State Machine 
The finite state machine, present in the _commandManager_ node, was developed as follows: 
* __NORMAL__ : First of all _NORMAL_ is the initial state. In this state the _FSM_ checks if the _state_ variable (which contains the strings published from the _speakPerception_ node) is equal to the string _play_. In that case the _FSM_ goes in _PLAY_ state. Otherwise it makes a request to the _Navigation_ service to go in a random position provided by the _getPosition_ node. 
Then this routine is iterated for a random number of times (max 3 times) after which the robot goes in _SLEEP_ mode. 
* __PLAY__ : In this state the _commandManager_ moves the robot to the goal position which is just the last position sent by the _getPosition_ node. Then it call again the _Navigation_ service sending as goal position the user position, in order to tell the robot to come back to the user. After then that the _FSM_ come back in _NORMAL_ mode.
* __SLEEP__ : The robot goes to the home which is a known position a priori chosen. Then it sleeps for a random time after which the _FSM_ goes in NORML mode. 

## Installation
In order to use this package it's necessary to install the _smach_ library which allows to implement a _Finite State Machine_. So on a command window digit:
```

$ sudo apt-get install ros-kinetic-smach-viewer
```
Of coure it's also required to make a _catkin_make_ in your _ROS_ workspace
### File list
In this package you can find in the _src_ directory the three nodes file and the service. In the _launch_ directory has been defined several launch files to test the system (_assignment1.launch_ launches every components of the system). _srv_ directory contains the definition of the only service of the architecture. Finally you can find three _bash command file_ usefull to test the system avoiding to digit long terminals commands :
- __run_sys.sh__ allows to launch all componets of the system without the _getPosition_node
- __run_gesPosition.sh__ launches the _getPosition_ node
- __impossiblePosition.sh__  just publishes on the _Position_ topic a position messagge which is out of the map. This is usefull to test the response of the system in case the user points a position which is not reachable from the robot.     

## Usage
First of all remeber to source your wrokspace in every terminal you will use.
If wou want run the whole project just type:
```

$ roslaunch assignment1 assignment1.launch
```
### Test getPosition 
In order to test in two different terminals the messages random generates by the _getPosition_ node and see the their effects, plese go to the _assignment1_ directory and execute from shell:
```

$ cd ~/assignment1
$ ./run_getPosition.sh
```
and then in another terminal execute
```

$ cd ~/assignment1
$ ./run_sys.sh
```
You will see in first terminal window the positions randomly generated by _getPostion_ and the response in real time of the _commandManager_ node.
### Test impossible position
```

$ cd ~/assignment1
$ ./run_sys.sh
```
and in a new terminal execute
```

$ cd ~/assignment1
$ ./impossiblePosition.sh
```